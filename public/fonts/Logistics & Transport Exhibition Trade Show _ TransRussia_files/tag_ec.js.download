(()=>{"use strict";const e=e=>void 0!==e;function t(e){return"object"==typeof e&&null!==e}let r=function(e){return e.Init="init",e.Params="params",e.ReachGoal="reachGoal",e.Hit="hit",e}({});class s{static visitParams(e,t,s){const n=`yaCounter${e}`,o=n in window?window[n]:window.Ya?._metrika?.counters?.[`${e}:0`];window.Ya?.Metrika&&o instanceof window.Ya.Metrika||!window.ym&&window.Ya?.Metrika2&&o instanceof window.Ya.Metrika2?o.params(t):window.ym&&(s?ym(e,r.Params,t,s):ym(e,r.Params,t))}static reachGoal(e,t,s){"undefined"!=typeof ym&&(s?ym(e,r.ReachGoal,t,s):ym(e,r.ReachGoal,t))}static hit(e,t,s){ym(e,r.Hit,t,s)}static getCounters(){const r=Ya._metrika.getCounters();return Array.isArray(r)?r.map((e=>{if(t(e)&&"number"==typeof e.id){const t=Number(e.type);return{id:e.id,type:isNaN(t)?void 0:t,accurateTrackBounce:!!e.accurateTrackBounce,clickmap:!!e.clickmap,trackHash:!!e.trackHash,trackLinks:!!e.trackLinks,webvisor:!!e.webvisor}}})).filter(e):[]}static getZeroCodeConversionMarkup(){let e;const t=window.Ya._metrika.ecmv;if(t){e=s.getCounters().reduce(((e,r)=>{const s=t[`${r.id}:0`];return s&&(e[r.id]=JSON.parse(s)),e}),{})}return e}}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function i(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let c=function(e){return e.Observer="Observer",e.Factor="Factor",e.Revenue="Revenue",e.Global="Global",e.EventsBus="EventsBus",e.Storage="Storage",e.Mutex="Mutex",e}({});class a{getDeprecatedResult(e){return Object.entries(e).reduce(((e,[t,r])=>{const s=t;return e[s]={factors:[]},r.forEach((t=>{e[s].factors.push(t.factorId),void 0!==t.revenue&&(e[s].revenue={...e[s].revenue,[t.revenueId||t.factorId]:t.revenue})})),e}),{})}getResult(e,t=!0){return Object.entries(e).reduce(((e,[r,s])=>{const n=r;return e[n]={},s.forEach((r=>{const s=t&&r.internalData?Object.entries(r.internalData).reduce(((e,[t,r])=>(e[t]=r?.slice(0,Math.min(r.length,200)),e)),{}):void 0;e[n][r.factorId]={...s,revenue:r.revenue}})),e}),{})}}class l extends a{sendZCData(e){this.send(this.getResult(e),"zc")}sendData(e){try{this.send(this.getResult(e),"ec2"),this.send(this.getDeprecatedResult(e))}catch(e){this.sendError(e,c.Global,"SEND")}}log(e,...t){}sendError(e,t,r){try{let s;const n=Array.isArray(r)?r:[r];s=e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:{name:"Unknown error",message:String(e)},this.send({error:{...s,scope:t,context:n}})}catch(e){}}send(e,t="ec"){s.getCounters().map((r=>{try{s.visitParams(r.id,{__ym:{[t]:e}})}catch(e){}}))}}let u;function d(){try{return u||(u=new l),u}catch(e){}}const h=/matrix\((?:\d+,\s*){4}(-?\d+),\s*(-?\d+)\s*\)/;class p{constructor(){i(this,"id",void 0),i(this,"scope",void 0),i(this,"findElementsByPatterns",((e,t=1e4,r=document.body)=>{const s=[],n=[],o=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:r=>{try{const n=r.nodeValue?.toLowerCase().trim();if(!n||n.length>t)return NodeFilter.FILTER_SKIP;const o=this.matchSome(n,e);if(o)return s.push(o),NodeFilter.FILTER_ACCEPT}catch(e){this.sendError(e,["TREE_WALKER"])}return NodeFilter.FILTER_SKIP}});for(;o.nextNode();){const e=o.currentNode.parentElement,t=s.shift();e&&"SCRIPT"!==e.tagName&&t&&n.push({node:e,match:t})}return n}))}static getNodeAttrsAndText(e){return{convBtnCls:e.className,convBtnId:e.id,convBtnText:e.innerText?.trim()?.toLowerCase()??""}}log(e,...t){d()?.log(e,...t)}sendError(e,t){d()?.sendError(e,this.scope,t)}hasStopPhrases(e,{match:t,index:r},{before:s,after:n,inMatched:o,contextLength:i}){if(o&&this.matchSome(t,{keywords:o}))return!0;if(s){const t=i?Math.max(r-i,0):0,n=e.slice(t,r).trim();if(this.matchSome(n,{keywords:s}))return!0}if(n){const s=e.slice(r+t.length,i?i+r+t.length:void 0).trim();if(this.matchSome(s,{keywords:n}))return!0}return!1}matchSome(e,t){const r=this.match(e,t);return r?r[0]:void 0}match(e,t,r=!1){const s=[],n=e.toLowerCase().trim();for(const e of t.keywords){if(e instanceof RegExp)for(const o of n.matchAll(e)){const e={match:o[0].trim(),index:o.index};if(!(t.stopPhrases&&this.hasStopPhrases(n,e,t.stopPhrases)||(s.push(e),r)))break}else{const r=n.indexOf(e);if(-1!==r){const o={match:e,index:r};t.stopPhrases&&this.hasStopPhrases(n,o,t.stopPhrases)||s.push(o)}}if(s.length>=1&&!r)break}return s.length?s.map((e=>({phrase:e.match,phraseContext:n.length<100?n:n.slice(e.index,e.index+100).trim()}))):void 0}collectAttrs(e,t=5){let r=1,s=e;const n={ids:[],classNames:[]};for(;s&&r<=t;)n.ids.push(s.id),n.classNames.push(s.className),s=s.parentElement,r++;return n}checkVisibility(e,t=void 0,r=13){let s=1,n=e;const o={display:"none",visibility:"hidden",opacity:0,...t};for(;s<r&&n;){if("script"===n.tagName?.toLowerCase())return!1;const e=window.getComputedStyle(n);if(Object.entries(o).some((([t,r])=>"number"==typeof r?parseFloat(e?.[t])===r:e?.[t]===r)))return!1;if("fixed"===e.position){if("-"===e.left?.[0]||"-"===e.right?.[0])return!1;const t=e.right?.match(/(\d+)%?/),r=t?.[1]?parseInt(t[1],10):0,s="%"===e.right?.[e.right?.length-1];if(r>=100&&s||r>=1e3)return!1;const n=e.transform?.match(h),o=n?.[1]?parseInt(n[1],10):0,i=n?.[2]?parseInt(n[2],10):0;if(o<0||i<0)return!1}s++,n=n.parentElement}return!0}}class m extends p{constructor(...e){super(...e),i(this,"scope",c.Factor),i(this,"convCount",0),i(this,"lastMatchTimestamp",void 0)}apply(e){if(this.convCount&&this.lastMatchTimestamp){const e=Date.now()-this.lastMatchTimestamp;if(e>6e4)this.convCount=0;else if(e<1e3||this.convCount>10)return{isMatched:!1}}const t=this.applyFactor(e),r="boolean"==typeof t?{isMatched:t}:t;return r.isMatched&&(this.convCount++,this.lastMatchTimestamp=Date.now()),r}}class f extends m{constructor(e){super(),this.selectors=e}applyFactor(e){const t=e.target;if(t instanceof HTMLElement){const e=this.selectors.flatMap((e=>[e,`${e} *`])).some((e=>t.matches(e)));return{isMatched:e,internalData:e?m.getNodeAttrsAndText(t):void 0}}return!1}}class v extends f{constructor(){super(["#bx-soa-orderSave a",".btn-order-save"]),i(this,"id","1c-bitrix-click")}}class g extends p{constructor(...e){super(...e),i(this,"scope",c.Revenue)}parsePrice(t){if(!t.length)return;const r=t.map((e=>{const t=e.textContent?(e=>{if(!e)return;const t=e.match(/[\d.,\s]+/)?.[0]?.replace(/\s/g,"");if(!t)return;const r=t.includes(","),s=t.includes(".");if(r&&s)return t.lastIndexOf(",")>t.lastIndexOf(".")?parseFloat(t.replace(/\./g,"").replace(",",".")):parseFloat(t.replace(/,/g,""));return r?parseFloat(t.replace(",",".")):parseFloat(t)})(e.textContent):void 0;if(t)return{matchedNode:e,revenue:t}})).filter(e).sort(((e,t)=>e.revenue-t.revenue)),s=r[r.length-1];return r.length?{revenue:s.revenue,matchedNode:s.matchedNode,internalData:{"raw-revenue":t.map((e=>e.textContent?.slice(50))).filter(e).slice(0,2).join(",")}}:void 0}}class w extends g{constructor(e){super(),this.selectors=e}apply(){const e=this.selectors.flatMap((e=>[...document.querySelectorAll(e)])),t=this.parsePrice(e);return t?((e,t)=>{const r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!t.includes(s)&&(r[s]=e[s]);return r})({...t},["matchedNode"]):t}}class y extends w{constructor(){super([".bx-soa-cart-total-line-total .bx-soa-cart-d"]),i(this,"id","1c-bitrix-click-parsed-revenue")}}class b extends f{constructor(){super([".litecheckout__submit-btn",'[name="dispatch[checkout.place_order]"]',"#litecheckout_place_order"]),i(this,"id","cs-cart-click")}}class k extends w{constructor(){super([".ty-checkout-summary__total-sum"]),i(this,"id","cs-cart-click-parsed-revenue")}}class C extends f{constructor(){super([".co-button--checkout","#create_order"]),i(this,"id","insales-click")}}class E extends w{constructor(){super([".co-basket_total-price"]),i(this,"id","insales-click-parsed-revenue")}}class x extends f{constructor(){super(['[name="finish_registration"]','[value="Подтвердить заказ"]',".nevigen-onestepcheckout-finish button",".button_order_finish","#button_order_finish","#cart-button-finish"]),i(this,"id","joomla-click")}}class _ extends w{constructor(){super([".jshop_subtotal .total .value","#total_cart .total .value",".totalvalue"]),i(this,"id","joomla-click-parsed-revenue")}}class S extends f{constructor(){super([".shop2-btn"]),i(this,"id","megagroup-click")}}class T extends w{constructor(){super([".cart-total__item.last_item .cart-total__body"]),i(this,"id","megagroup-click-parsed-revenue")}}class P extends f{constructor(){super(["#simplecheckout_button_confirm",'[data-onclick="createOrder"]',"#button-confirm","#confirm_checkout","#button_checkout","#button-go"]),i(this,"id","opencart-click")}}class L extends w{constructor(){super(["#total_total .simplecheckout-cart-total-value","#unicheckout .total","#total_total"]),i(this,"id","opencart-parsed-revenue-selector-data-collector")}}class R extends f{constructor(){super(['[class*="cartpage-form"] .t-submit','[class*="orderform"] .t-submit']),i(this,"id","tilda-click")}}const O=['[class*="cartwin-totalamount-content"] [class*="cartwin-prodamount-price"]'];class M extends w{constructor(){super(O),i(this,"id","tilda-parsed-revenue-selector-data-collector")}}class I extends m{constructor(...e){super(...e),i(this,"buttonSelector",'[class*="btn"], [class*="submit"], [class*="button"], [class*="confirm"], [id*="btn"], [id*="submit"], [id*="button"], [id*="confirm"], a, button, [type="submit"], [name="submit"]'),i(this,"blockClasses",["buttons"]),i(this,"keywords",[/(:?завершить|подтвердить)[\p{P}\s]*(\sи\s)*(:?$|оформление|заказ|отправить|покупку)/gu,/отправить[\p{P}\s]*(:?$|заказ|заявку)/gu,/(?<!\p{L})(:?сделать|создать|разместить|оставить)[\p{P}\s]+заказ/gu,/оформ(:?ить|ляю|ляем)|заказать|оплатить|к оплате|записаться|купить быстро|пожертвовать/gu]),i(this,"contentPatterns",{keywords:this.keywords,stopPhrases:{before:[/(?<!\p{L})(?:как|можно|можем|чтобы|почему|код)(?!\p{L})/gu],after:[/(?<!\p{L})возврат|звонок(?!\p{L})/gu],contextLength:30}}),i(this,"id","universal-conversion-collector"),i(this,"checkContent",(e=>{const t=e?.innerText?.trim().toLowerCase(),r=e?.getAttribute("value")?.trim().toLowerCase();let s;return t&&t.length<=50&&(s=this.matchSome(t,this.contentPatterns)),!s&&r&&(s=this.matchSome(r,this.contentPatterns)),!!s}))}applyFactor(e){if(!(e.target instanceof HTMLElement))return!1;let t=e.target,r=!1;for(let e=1;e<=2&&t;e++)if(t=t.closest(this.buttonSelector),t&&!this.matchSome(t.className||"",{keywords:this.blockClasses})){if(r=this.checkContent(t),r)break;t=t.parentElement}return{isMatched:r,internalData:r&&t?m.getNodeAttrsAndText(t):void 0}}}class N extends I{constructor(...e){super(...e),i(this,"keywords",[/(?:заказать|обратный)\s+звонок/gu,/отправить\s+запрос/gu,/(?<!\p{L})оставить\s+(?:запрос|заявку)/gu]),i(this,"contentPatterns",{keywords:this.keywords,stopPhrases:{before:[/(?<!\p{L})(?:как|можно|чтобы)(?!\p{L})/gu],contextLength:30}}),i(this,"id","universal-lead-collector")}}class D extends g{constructor(...e){super(...e),i(this,"id","universal-revenue-collector"),i(this,"selector",'[class*="total"]:not([class*="totals"]), [class*="sum"]'),i(this,"keywords",[/(?<!\p{L})итог/giu]),i(this,"lowPriorityKeywords",["всего:",/(?<!минимальн\S\S\s)сумм/gi,"к оплате","стоимость товаров","общая стоимость"]),i(this,"revenueRegExp",/\b(\d+(?:[.,\s]\d{3})*)(?:[.,]\d{1,2}(?!\d))?/g),i(this,"blackList",[/ндс[ \p{P}]*$/iu,/(.)(минимальный\s+заказ|мин\.?\s*заказ)\s*[:;.,!?-]*\s*$/i,/размер[ \p{P}]*$/iu,/доставк\S[ \p{P}]*$/iu]),i(this,"parseRevenue",(e=>{let t;const r=[];for(;null!==(t=this.revenueRegExp.exec(e));){const s=e.substring(0,t.index);if(this.blackList.some((e=>e.test(s.toLowerCase().trim())))){this.log("BLACKLIST MATCHED",s.toLowerCase().trim());continue}const n=Number.parseFloat(t[1].replace(/[.,\s]/g,""));n>=99&&n<=999999&&r.push(n)}return r}))}apply(e){const t=[];for(const e of this.findElementsByPatterns({keywords:this.keywords},50)){this.findRevenue(e.node).items.length&&t.push(this.findRevenue(e.node))}let r=this.getRelevantValue(t);if(r)return this.log("HIGH PRIORITY VERDICT",r),r;for(const e of this.findElementsByPatterns({keywords:this.lowPriorityKeywords},50)){this.findRevenue(e.node).items.length&&t.push(this.findRevenue(e.node))}return t.length&&this.log("low priority results",t),t&&0!==t.length&&(r=this.getRelevantValue(t,!0)),r&&this.log("LOW PRIORITY VERDICT",r),r}getRelevantValue(e,t=!1){let r=e.filter((e=>e.isSelectorMatched&&1===e.items.length));return r.length?Math.min(...r.flatMap((e=>e.items))):t?(r=e.filter((e=>e.items.length)).sort(((e,t)=>{const r=e.items.length-t.items.length;return 0===r?e.isSelectorMatched?1:-1:r})),r[0]?.items.length?Math.min(...r[0].items):void 0):void 0}findRevenue(e){let t=[],r=e,s=0,n=!0,o=!1;for(;r&&!t.length&&s<5;){const e=window.getComputedStyle(r);if("none"===e.display||"line-through"===e.textDecoration)break;const i=r.textContent?.toLowerCase().trim()||"";if(i.length>350){this.log("MAX TEXT LENGTH EXCEEDED",i);break}if(i.length&&(t=this.parseRevenue(i)),t.length){this.log("RESULT NODE",r);break}let c;o?c=r.parentElement?.closest(this.selector):(c=r.nextElementSibling,o=!0),c||(n=!1,c=r.parentElement),r=c,s++}return{items:t,isSelectorMatched:n}}}class A extends f{constructor(){super([".js-submit-order-button"]),i(this,"id","webasyst-click")}}class F extends w{constructor(){super([".wa-item-total .wa-price"]),i(this,"id","webasyst-click-parsed-revenue")}}class B extends f{constructor(){super([".wc-block-components-checkout-place-order-button",'[name="woocommerce_checkout_place_order"]',"#place_order"]),i(this,"id","woocommerce-click-selector-factor-collector")}}class K extends w{constructor(){super([".wc-block-components-totals-item__value",".order-total .woocommerce-Price-amount"]),i(this,"id","woocommerce-parsed-revenue-selector-data-collector")}}class j extends m{constructor(e){super(),this.conversionMarkupByCounter=e,i(this,"id","zero-code-checkout-click"),i(this,"maxSearchDepth",5)}applyFactor(e){const t=e.target;if(!(t instanceof HTMLElement))return!1;let r=t,s=0;for(;r&&s<this.maxSearchDepth;){const e=this.checkConversion(r);if(e)return{...e,internalData:{...e.internalData,convCheckoutDepth:s.toString(),...m.getNodeAttrsAndText(r)}};r=r.parentElement,s++}return!1}checkConversion(e){for(const t of Object.keys(this.conversionMarkupByCounter)){const r=(this.conversionMarkupByCounter[t].conversion_button??[]).find((([t,r])=>e.matches(r)));if(r)return{isMatched:!0,internalData:{counterIdConversion:t,algorithmConversion:r[0]}}}return!1}}const Y=1e3,$=e=>e.length>Y?e.slice(0,Y):e,U=new Set(["id","class","for","href","src","name","title","alt","role","type","aria-labelledby","aria-controls","aria-describedby","data-testid","data-test-id","data-qa"]),G=(e,t)=>{try{let s="";"id"===e&&t.length>0?(r=t,s=`#${CSS.escape(r)}`):s=((e,t)=>`[${e}='${CSS.escape(t)}']`)(e,t);const n=document.querySelectorAll(s).length;return[1===n,0===n]}catch{return[!1,!0]}var r},H=e=>t=>{if("function"!=typeof t.getAttributeNames)return{};let r=t.getAttributeNames();e&&(r=r.filter((t=>e.has(t)||t.startsWith("data-"))));return r.reduce(((e,r)=>{if(r.length>Y)return e;let s=t.getAttribute(r)||"";s=$(s);const[n,o]=G(r,s);return e[r]={value:s,isUnique:n},o&&(e[r].isBroken=!0),e}),{})},V=H(U),Z=(H(),(e,t)=>{const r={};try{const s=V(e);return s&&Object.entries(s).forEach((([e,s])=>{r[`${t}-${e}`]=JSON.stringify(s,null,4)})),r}catch(e){d()?.sendError(e,"revenue"===t?c.Revenue:c.Factor,["ZERO_CODE_GET_CRITICAL_ATTRIBUTES"])}return r});class W extends g{constructor(e){super(),this.conversionMarkupByCounter=e,i(this,"id","zero-code-revenue")}apply(e){for(const e of Object.keys(this.conversionMarkupByCounter)){const t=this.conversionMarkupByCounter[e].revenue_container;if(t)for(const[r,s]of t){const t=[...document.querySelectorAll(s)];if(t.length){const s=this.parsePrice(t);if(s){const t=Z(s.matchedNode,"revenue");return{...s,internalData:{...s.internalData,algorithmRevenue:r,counterIdRevenue:e,...t}}}}}}}}let q=function(e){return e.CreateOrderClick="create_order_click",e.CreateOrderClickCapture="create_order_click_capture",e.CreateOrderSubmit="create_order_submit",e.CreateOrderRequest="create_order_request",e.CreateOrderResponse="create_order_response",e.OrderThankYouPage="order_thank_you_page",e.CreateLeadClick="create_lead_click",e}({});const X="ecom-event";class z{constructor(e,t){this.target=e,this.transport=t}on(e,t){this.target.addEventListener(X,(r=>{try{e.includes(r.detail.eventKind)&&t(r.detail)}catch(e){this.transport?.sendError(e,c.EventsBus,[X,"ON_EVENT"])}}))}emit(e){try{this.target.dispatchEvent(new CustomEvent(X,{detail:e}))}catch(t){this.transport?.sendError(t,c.EventsBus,["EMIT",e.sourceId,e.eventKind])}}}let J;function Q(){const e=d();try{J||(J=new z(new EventTarget,e))}catch(t){e?.sendError(t,c.EventsBus,"CREATE_EVENTS_BUS")}return J}class ee{constructor(e){this.collectors=e,i(this,"id",void 0)}stop(){}processEvent(t){const r=d();if(r)try{Object.entries(this.collectors).forEach((([s,n])=>{let o=n.map((({factor:e,revenue:r,isZeroCodeCollector:s})=>{const n=this.applyCollector(t,e);if(!n)return;const o="boolean"==typeof n.res?{isMatched:n.res}:n.res;if(!o.isMatched)return;const i={factorId:e.id,revenue:o.revenue,revenueId:void 0!==o.revenue?e.id:void 0,internalData:{...o.internalData,factorPerf:n.perf.toFixed(2).toString(),observer:this.id},isZeroCodeCollector:s};if(void 0!==i.revenue||!r)return i;const c=this.applyCollector(t,r);if(!c?.res)return i;const a="object"==typeof c.res?c.res:{revenue:c.res};return{...i,revenue:a.revenue,revenueId:r.id,internalData:{...i.internalData,...a.internalData,revPerf:c.perf.toFixed(2).toString()}}})).filter(e);if(!o.length)return;const i=o.filter((e=>!!e.isZeroCodeCollector));o=o.filter((e=>!e.isZeroCodeCollector)),o.length&&r.sendData({[s]:o}),i.length&&r.sendZCData({[s]:i}),Q()?.emit({sourceId:this.id,eventKind:s,result:o})}))}catch(e){r.sendError(e,c.Observer,[this.id,"PROCESS_EVENT"])}}applyCollector(e,t){const r=d();if(r)try{const r=performance.now();return{res:t.apply(e),perf:performance.now()-r}}catch(e){r.sendError(e,t.scope,[this.id,t.id])}}}class te extends ee{constructor(...e){super(...e),i(this,"id","base-click-observer"),i(this,"clickCb",void 0),i(this,"capture",!1)}start(){this.clickCb=e=>{this.processEvent(e)},window.document.addEventListener("click",this.clickCb,{capture:this.capture})}stop(){this.clickCb&&window.document.removeEventListener("click",this.clickCb,{capture:this.capture})}}class re extends te{constructor(...e){super(...e),i(this,"id","capture-click-observer"),i(this,"capture",!0)}}function se(e,t=!1){return e.map((([e,r])=>({factor:e,revenue:r,isZeroCodeCollector:t})))}function ne(){let e;try{e=s.getZeroCodeConversionMarkup()}catch(e){d()?.sendError(e,c.Global,["GET_ZERO_CODE_CONVERSION_MARKUP"])}return e?[[new j(e),new W(e)]]:[]}function oe(e,t=!1){return{[e]:[...se([[new v,new y],[new b,new k],[new C,new E],[new x,new _],[new S,new T],[new P,new L],[new R,new M],[new A,new F],[new B,new K],[new I,new D]]),...t?se(ne(),!0):[]]}}class ie extends m{parseEvent(e){if("https://ru-ibe.tlintegration.ru"!==e?.origin||!e?.data||"string"!=typeof e.data)return;const t=e.data.match(/\{.*}/)?.[0];if(!t)return;const{data:r}=JSON.parse(t);return"object"==typeof r&&"_method"in r?{method:r._method,action:r.action,event:r._event,revenue:"number"==typeof r.amount?r.amount:void 0,target:r.target}:void 0}}class ce extends ie{constructor(...e){super(...e),i(this,"id","universal-tl-collector"),i(this,"revenue",void 0)}applyFactor(e){const t=this.parseEvent(e);return!!t?.action&&("change-order-price"===t.action&&t.revenue?(this.revenue=t.revenue,!1):"click"===t.action&&"payment-pay-button"===t.target&&{isMatched:!0,revenue:this.revenue})}}class ae extends ie{constructor(...e){super(...e),i(this,"id","universal-tl-typ-collector")}applyFactor(e){const t=this.parseEvent(e);return"bookingSuccess"===t?.event}}class le extends m{constructor(...e){super(...e),i(this,"id","universal-uhotels-collector"),i(this,"revenue",void 0)}applyFactor(e){if("https://api.uhotels.app"!==e.origin||!e?.data||!t(e.data))return!1;const r=e.data;return t(r.data)&&"priceNf"in r.data&&"number"==typeof r.data.priceNf&&(this.revenue=r.data.priceNf),"save-booking"===r.event&&{isMatched:!0,revenue:this.revenue}}}class ue extends ee{constructor(...e){super(...e),i(this,"id","message-observer"),i(this,"onMessageCb",void 0)}start(){this.onMessageCb=e=>{this.processEvent(e)},window.addEventListener("message",this.onMessageCb)}stop(){this.onMessageCb&&window.removeEventListener("message",this.onMessageCb)}}function de(){return[[new ce],[new le]]}let he,pe=function(e){return e.TYPEnabled="ea84",e}({});class me{constructor(e,t){this.storage=e,this.transport=t}getKey(e){try{return this.storage.getItem(e)}catch(e){this.transport?.sendError(e,c.Storage,"GET_KEY")}return null}setKey(e,t){try{this.storage.setItem(e,t)}catch(e){this.transport?.sendError(e,c.Storage,"SET_KEY")}}}function fe(){const e=d();try{he||"function"!=typeof window.localStorage?.getItem||(he=new me(window.localStorage,e))}catch(t){e?.sendError(t,c.Storage,"CREATE_STORAGE")}return he}const ve=/tilda|afisha/gu;class ge{constructor(e,t){this.storage=e,this.eventBus=t,i(this,"reset",void 0),t.on([q.CreateOrderClickCapture,q.CreateOrderSubmit,q.CreateOrderResponse,q.OrderThankYouPage],this.onEcomEvent.bind(this))}isTypEnabled(){return!!ve.test(window.location.host)||"1"===this.storage.getKey(pe.TYPEnabled)}onEcomEvent(e){const t=e.eventKind!==q.OrderThankYouPage;this.reset&&(clearTimeout(this.reset),this.reset=void 0),t?this.storage.setKey(pe.TYPEnabled,"1"):this.reset=setTimeout((()=>{this.storage.setKey(pe.TYPEnabled,"0")}),500)}}let we;function ye(){const e=d();try{if(!we){const e=fe(),t=Q();if(!e||!t)return;we=new ge(e,t)}}catch(t){e?.sendError(t,c.Mutex,"CREATE_TYP_MUTEX")}return we}class be extends m{constructor(){super(),i(this,"id","universal-thank-you-page-collector"),i(this,"titleKeywords",[/^(?:спасибо|благодарим|страница благодарности|благодарность)\p{P}*$/gu]),i(this,"commonKeywords",[/(?:заказ|бронь|обращение|заявка|покупка)(?:\s+\S+){0,3}\s+(?:создан|оформлен|принят|сформирован|размещен|получен|оплачен|отправлен|обработан|обрабатывается)[ао]?(?!\p{L})/gu,/(?<!\p{L})(?:спасибо|благодарим|благодарность|благодарит)\p{P}*(?:\s+\S+){0,3}\s+(?:заказ|покупку|заявку|пожертвование)(?!\p{L})/gu,/(?:звонит|свяжется)\s+(?:оператор|менеджер)\s+(?:и согласует заказ|для подтверждения заказа)/gu,/(^скачать билеты?$)|(^электронный билет$)/gu]),i(this,"urlKeywords",[/thank|spasibo|success|(?:^|\/)uspeh(?:$|\/)/gu,/(?:order|basket|checkout).*complete/gu,/complete.*(?:order|basket|checkout)/gu]),i(this,"blockPhraseInPath",[/auth|regist|signup|unsuccess|subscribe|letter|remind|webinar|login|pass|anketa|(?<!\p{L})faq(?!\p{L})|otz[iy]v[iy]|help|dostavka|delivery|uslovia|terms|success[_-]?story|instruktsiya|contact/gu]),i(this,"contentPatterns",{keywords:this.commonKeywords,stopPhrases:{inMatched:[/будет|можно|может|быть|должен|(?<!\p{L})не(?!\p{L})/gu],before:[/(?<!\p{L})(?:чтобы|что|если|при необходимости)(?!\p{L})/gu],after:[/(?<!\p{L})(?:до|после)(?!\p{L})/gu],contextLength:60}}),i(this,"typSelector",'[class*="message_ok"]'),i(this,"feedbackSelector",'[class*="message"], [class*="comment"], [class*="review"], [class*="feedback"], [class*="answer"], [class*="Review"], [class*="Fake"]'),i(this,"mutex",void 0),this.mutex=ye()}applyFactor(e){let t,r="title";const s=document.title.toLowerCase().trim(),n=this.getRelUrl(),o=window.location.pathname.toLowerCase(),i={};if(this.matchSome(o,{keywords:this.blockPhraseInPath}))return!1;if(t=this.matchSome(s,{keywords:[...this.titleKeywords,...this.commonKeywords]}),t||(t=this.matchSome(n,{keywords:this.urlKeywords}),r="url"),!t&&this.mutex&&!this.mutex.isTypEnabled())return this.log("TYP is disabled"),!1;if(!t){const e=this.matchContent();e?.length&&(t={phrase:e[0].phrase,phraseContext:e[0].phraseContext},i.matchedClasses=e[0].classNames.join(","),i.matchedIds=e[0].ids.join(",")),r="content"}return!!t&&{isMatched:!0,internalData:{target:r,fullPath:n,title:s,...t,...i,version:"8"}}}matchContent(){let e=this.findElementsByPatterns(this.contentPatterns);if(e=e.filter((({node:e})=>!(!e.closest(this.typSelector)&&e.closest(this.feedbackSelector))&&this.checkVisibility(e))),e.length)return e.map((e=>({...e.match,...this.collectAttrs(e.node)})))}getRelUrl(){const e=window.location,t=new URLSearchParams([...new URLSearchParams(e.search).entries()].filter((([e])=>!e.toLowerCase().includes("utm")))).toString();return`${e.pathname}${t}${e.hash}`.toLowerCase()}}class ke extends ee{constructor(...e){super(...e),i(this,"id","page-hide-observer"),i(this,"callback",void 0)}start(){this.callback=()=>{document.body&&this.processEvent(void 0)},window.addEventListener("visibilitychange",this.callback)}stop(){this.callback&&window.removeEventListener("visibilitychange",this.callback)}}class Ce extends m{constructor(e){super(),this.views=e,i(this,"isPageReloaded",void 0),this.isPageReloaded=window.performance.navigation&&1===window.performance.navigation.type||window.performance.getEntriesByType("navigation").some((e=>"type"in e&&"reload"===e.type))}applyFactor(){return this.views.some((({url:e,referrer:t})=>{const r=!e||("string"==typeof e?document.location.href.includes(e):e.test(document.location.href)),s=this.isPageReloaded?"":document.referrer,n=!t||("string"==typeof t?s.includes(t):t.test(s));return r&&n}))}}class Ee extends Ce{constructor(){super([{url:"/order/?ORDER_ID=",referrer:"/order/"}]),i(this,"id","1c-bitrix-page-view")}}class xe extends Ce{constructor(){super([{url:"index.php?dispatch=checkout.complete",referrer:"index.php?dispatch=checkout.checkout"}]),i(this,"id","cs-cart-page-view")}}class _e extends Ce{constructor(){super([{url:"/orders/",referrer:/\/new_order$/}]),i(this,"id","insales-page-view")}}class Se extends w{constructor(){super([".co-price"]),i(this,"id","insales-page-view-parsed-revenue")}}class Te extends Ce{constructor(){super([{url:"checkout/finish",referrer:"checkout"},{url:"/finish",referrer:/\/step\d/}]),i(this,"id","joomla-page-view")}}class Pe extends Ce{constructor(){super([{url:"/index.php?route=checkout/success"},{url:"/order-success/"}]),i(this,"id","opencart-page-view")}}class Le extends Ce{constructor(){super([{url:"/checkout/success",referrer:"/order"}]),i(this,"id","webasyst-page-view")}}class Re extends ee{constructor(...e){super(...e),i(this,"id","page-view-observer"),i(this,"urlWatchTimeout",void 0),i(this,"currentUrl",void 0)}start(){this.urlWatchTimeout=setInterval((()=>{this.checkUrl()}),100),this.checkUrl()}stop(){this.urlWatchTimeout&&clearTimeout(this.urlWatchTimeout)}checkUrl(){try{location.href!==this.currentUrl&&document.body&&(this.currentUrl=location.href,this.processEvent(void 0))}catch(e){d()?.sendError(e,c.Observer,"URL_WATCH")}}}const Oe=d();try{Oe?.log("START ECOM COLLECTOR"),[new te({...oe(q.CreateOrderClick,!0)}),new re({...oe(q.CreateOrderClickCapture),[q.CreateLeadClick]:se([[new N]])}),new Re({[q.OrderThankYouPage]:se([[new _e,new Se],[new Pe],[new Te],[new Le],[new xe],[new Ee],[new be]])}),new ke({[q.OrderThankYouPage]:se([[new be]])}),new ue({[q.CreateOrderClickCapture]:se(de()),[q.CreateOrderClick]:se(de()),[q.OrderThankYouPage]:se([[new ae],[new le]])})].forEach((e=>e.start()))}catch(e){Oe?.sendError(e,c.Global,"INIT")}})();